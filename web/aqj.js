export const AQJ_TITLE = "AQ 日本語版（一般成人用）";

export const AQJ_INSTRUCTIONS = [
  "次の 50 項目について、「あてはまる」〜「あてはまらない（ちがう）」の 4 段階から最も適切な番号を 1 つ選び、○をつけてください。",
  "すべての項目に回答してください。"
];

export const AQJ_SCALE = [
  { value: "1", title: "1", description: "あてはまる" },
  { value: "2", title: "2", description: "どちらかといえば、あてはまる" },
  { value: "3", title: "3", description: "どちらかといえば、あてはまらない" },
  { value: "4", title: "4", description: "あてはまらない（ちがう）" }
];

export const AQJ_QUESTIONS = [
  { id: 1, text: "何かをするときには，一人でするよりも他の人といっしょにすることを好む。" },
  { id: 2, text: "同じことや、同じやりかたを，何度もくりかえすことが好きだ。" },
  { id: 3, text: "何かを想像しようとするとき，その映像（イメージ）を簡単に思い浮かべることができる。" },
  { id: 4, text: "一つのことに夢中になって，ほかのことがぜんぜん目に入らなくなる（気がつかなくなる）ことがよくある。" },
  { id: 5, text: "他の人は気がつかないような，小さな物音に気がつくことがしばしばある。" },
  { id: 6, text: "車のナンバーや時刻表の数字などといった一連の数字のような特に意味のない情報に注目する（こだわる）ことがよくある。" },
  { id: 7, text: "自分ではていねいに話したつもりでも，話し方が失礼だと周囲の人から言われることがよくある。" },
  { id: 8, text: "小説（物語）などを読んでいるとき，登場人物がどのような人か（外見など）について簡単に想像することができる。" },
  { id: 9, text: "日付・曜日などについてのこだわりがある。" },
  { id: 10, text: "パーティーや会合などで，いろいろな（複数の）人の会話についていくことが簡単にできる。" },
  { id: 11, text: "自分がおかれている社会的な状況（その場での自分の立場）がすぐにわかる。" },
  { id: 12, text: "ほかの人は気がつかないような細かいことに，すぐに気づくことが多い。" },
  { id: 13, text: "パーティーなどよりも，図書館に行く方が好きだ。" },
  { id: 14, text: "新しい話（ストーリー）を，すぐにつくることができる。" },
  { id: 15, text: "モノよりも人間の方に魅力を感じる。" },
  { id: 16, text: "それをすることができないとひどく混乱（あるいは興奮）してしまうくらい強い興味や関心を持っていること（もの）がある。" },
  { id: 17, text: "他の人と，雑談などのような，ちょっとした会話（おしゃべり）を楽しむことができる。" },
  { id: 18, text: "自分が話をしているときには，なかなか他の人に横から口をはさませない。" },
  { id: 19, text: "数字（番号）に対するこだわりがある。" },
  { id: 20, text: "小説などを読んだり，テレビドラマなどを観ているとき，登場人物の意図や考えなどをよく理解できないことがある。" },
  { id: 21, text: "小説などのようなフィクションの本を読むことは，あまり好きではない。" },
  { id: 22, text: "新しい友人を作ることは，苦手である。" },
  { id: 23, text: "いつでも，ものごとの中に何らかのパターン（型や決まりなど）のようなものがあることに気づく。" },
  { id: 24, text: "博物館に行くよりも，劇場や映画館に行く方が好きだ。" },
  { id: 25, text: "自分のいつもの日課（行動の順序など）が妨害されても，混乱するようなことはない。" },
  { id: 26, text: "会話をどのように続けたらいいのか，わからなくなってしまうことがよくある。" },
  { id: 27, text: "誰かと話しをしているときに，相手の話の「言外の意味」を容易に理解することができる。" },
  { id: 28, text: "ものごとの細かいところよりも，全体像に注意が向くことが多い。" },
  { id: 29, text: "電話番号をおぼえるのは苦手である。" },
  { id: 30, text: "状況（部屋の様子やものの置き場所など）や人間の外見（服装や髪型）などが，いつもと少し違うくらいでは，すぐには気がつかないことが多い。" },
  { id: 31, text: "自分の話を聞いている相手が退屈しているときには，どのように話をすればいいのかわかっている。" },
  { id: 32, text: "同時に 2 つ以上のことをするのは，容易である。" },
  { id: 33, text: "電話で話をしているとき，自分が話をするタイミングがわからないことがある。" },
  { id: 34, text: "自分から進んで（自発的に）何かをすることは楽しい。" },
  { id: 35, text: "冗談がわからないことがよくある。" },
  { id: 36, text: "相手の顔を見れば，その人が考えていることや感じていることがわかる。" },
  { id: 37, text: "何かをしているときに，じゃまが入っても，すぐにそれまでやっていたことに戻ることができる。" },
  { id: 38, text: "雑談や，ちょっとしたおしゃべりを人とすることが得意だ。" },
  { id: 39, text: "同じことを何度も繰り返していると，周囲の人によく言われる。" },
  { id: 40, text: "子どものころ，友達といっしょに「○○ごっこ」（ごっこ遊び）をよくして遊んでいた。" },
  { id: 41, text: "特定の種類（カテゴリー）のもの（たとえば車・鳥・昆虫など）についての情報を集めることが好きだ。" },
  { id: 42, text: "あること（もの）を，他の人がどのように感じているかを想像することは苦手だ。" },
  { id: 43, text: "自分がすることは，どんなことでも注意深く計画するのが好きだ。" },
  { id: 44, text: "社交的な（人と親しく交わる）場面は楽しい。" },
  { id: 45, text: "他の人の考え（意図など）を理解することは苦手だ。" },
  { id: 46, text: "新しい場面（状況）では不安を感じやすい。" },
  { id: 47, text: "初対面の人と会うことは楽しい。" },
  { id: 48, text: "社交的である。" },
  { id: 49, text: "家族や友人などの誕生日をおぼえるのは苦手だ。" },
  { id: 50, text: "子どもと「ごっこ遊び」をして遊ぶのがとても得意だ。" }
];

export const DEFAULT_SECTION_SIZE = 10;
export const TOTAL_QUESTIONS = AQJ_QUESTIONS.length;

export function chunkQuestions(questions, chunkSize = DEFAULT_SECTION_SIZE) {
  const chunks = [];
  for (let i = 0; i < questions.length; i += chunkSize) {
    chunks.push(questions.slice(i, i + chunkSize));
  }
  return chunks;
}

export function getRangeLabel(chunk) {
  if (!chunk.length) {
    return "";
  }
  const first = chunk[0].id;
  const last = chunk[chunk.length - 1].id;
  return `質問 ${first}〜${last}`;
}

export function formatQuestionId(id) {
  return `question-${String(id).padStart(2, "0")}`;
}

export function createRadioOption({ value, title, description }, name, checkedValue) {
  const wrapper = document.createElement("label");
  wrapper.className = "choice-option";

  const input = document.createElement("input");
  input.type = "radio";
  input.name = name;
  input.value = value;
  input.checked = checkedValue === value;

  const label = document.createElement("span");
  label.className = "choice-label";
  label.textContent = `${title}`;

  if (description) {
    const desc = document.createElement("span");
    desc.className = "choice-desc";
    desc.textContent = description;
    label.appendChild(desc);
  }

  wrapper.appendChild(input);
  wrapper.appendChild(label);
  return wrapper;
}

export function createDropdownOptions(select, selectedValue) {
  const placeholder = document.createElement("option");
  placeholder.value = "";
  placeholder.textContent = "選択してください";
  placeholder.disabled = true;
  placeholder.selected = !selectedValue;
  select.appendChild(placeholder);

  AQJ_SCALE.forEach((option) => {
    const opt = document.createElement("option");
    opt.value = option.value;
    opt.textContent = `${option.value}: ${option.description}`;
    if (option.value === selectedValue) {
      opt.selected = true;
    }
    select.appendChild(opt);
  });

  return select;
}

export function createInstructionsList(container) {
  container.innerHTML = "";
  const list = document.createElement("ul");
  list.className = "instructions-list";
  AQJ_INSTRUCTIONS.forEach((text) => {
    const li = document.createElement("li");
    li.textContent = text;
    list.appendChild(li);
  });
  container.appendChild(list);
}

export function describeScaleValue(value) {
  const option = AQJ_SCALE.find((opt) => opt.value === value);
  return option ? `${option.value}: ${option.description}` : "";
}

export function getQuestionIndex(questionId) {
  return questionId - 1;
}

export function createAnswerStore() {
  const answers = AQJ_QUESTIONS.map(() => null);

  function set(questionId, value) {
    const idx = getQuestionIndex(questionId);
    answers[idx] = value;
  }

  function get(questionId) {
    const idx = getQuestionIndex(questionId);
    return answers[idx];
  }

  function clear() {
    for (let i = 0; i < answers.length; i += 1) {
      answers[i] = null;
    }
  }

  function getAnsweredCount() {
    return answers.filter(Boolean).length;
  }

  function getUnansweredQuestionIds() {
    return AQJ_QUESTIONS.filter((question) => !answers[getQuestionIndex(question.id)]).map(
      (question) => question.id
    );
  }

  function isComplete() {
    return getAnsweredCount() === AQJ_QUESTIONS.length;
  }

  function toSummaryEntries() {
    return AQJ_QUESTIONS.map((question) => ({
      id: question.id,
      text: question.text,
      value: answers[getQuestionIndex(question.id)]
    }));
  }

  function toPlainText() {
    return toSummaryEntries()
      .map((entry) => `Q${entry.id}: ${entry.value ?? "-"} (${entry.text})`)
      .join("\n");
  }

  return {
    set,
    get,
    clear,
    getAnsweredCount,
    getUnansweredQuestionIds,
    isComplete,
    toSummaryEntries,
    toPlainText
  };
}

export function formatSummaryEntries(entries) {
  return entries.map((entry) => ({
    id: entry.id,
    text: entry.text,
    value: entry.value,
    label: entry.value ? describeScaleValue(entry.value) : "未回答"
  }));
}

export function summarizeAnswers(answerStore, { allowIncomplete = false } = {}) {
  const answeredCount = answerStore.getAnsweredCount();
  const total = AQJ_QUESTIONS.length;
  const missingQuestionIds = answerStore.getUnansweredQuestionIds();
  return {
    answeredCount,
    total,
    missingQuestionIds,
    entries: formatSummaryEntries(answerStore.toSummaryEntries()),
    plainText: answerStore.toPlainText(),
    canDisplaySummary: allowIncomplete || missingQuestionIds.length === 0
  };
}


